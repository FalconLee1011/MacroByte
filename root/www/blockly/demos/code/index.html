<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="google" value="notranslate">
  <title>Macro:Byte</title>
  <link rel="stylesheet" href="style.css">
  <style>
	  .scroll-box {
	      background: #f4f4f4;
	      border: 2px solid rgba(0, 0, 0, 0.1);
	      height: auto; /* maximum height of the box, feel free to change this! */
        min-height: 100% !important;
	      padding: 15px;
	      overflow-y: scroll;
	  }
    textarea#log {
    	width:100%;
      height:100px;
    	box-sizing:border-box;
    	display:block;
    	max-width:100%;
      max-height:100px;
    	line-height:8;
    	border-radius:3px;
    	border:1px solid #F7E98D;
    	font:13px Tahoma, cursive;
    	transition:box-shadow 0.5s ease;
    	box-shadow:0 4px 6px rgba(0,0,0,0.1);
    	font-smoothing:subpixel-antialiased;
    	background:linear-gradient(#F9EFAF, #F7E98D);
    	background:-o-linear-gradient(#F9EFAF, #F7E98D);
    	background:-ms-linear-gradient(#F9EFAF, #F7E98D);
    	background:-moz-linear-gradient(#F9EFAF, #F7E98D);
    	background:-webkit-linear-gradient(#F9EFAF, #F7E98D);
    }

    .projectname {
        font-size:24px;
    }
    .watermark {
        opacity: 0.5;
        color: BLACK;
        position: fixed;
        top: auto;
        left: 80%;
        font-size:48px;
    }
	  </style>
<!--
  <script src="https://www.google.com/jsapi"></script>
    -->
    <!--改用本地jquery-->
  <script src="jquery-3.2.1.min.js"></script>
  <script src="storage.js"></script>
  <script src="../../blockly_compressed.js"></script>
  <script src="../../blocks_compressed.js"></script>
  <script src="../../javascript_compressed.js"></script>
  <script src="../../python_compressed.js"></script>
  <script src="../../php_compressed.js"></script>
  <script src="../../lua_compressed.js"></script>
  <script src="../../dart_compressed.js"></script>
  <script src="code.js"></script>
  <script src="FileSaver.js"></script>
  <script>
    Blockly.Blocks['websocket_'] = {
      init: function() {
        this.appendDummyInput()
            .appendField("Websocket Server");
        this.appendDummyInput()
            .appendField("message_received")
            .appendField(new Blockly.FieldVariable("client"), "client")
            .appendField(new Blockly.FieldVariable("server"), "server")
            .appendField(new Blockly.FieldVariable("message"), "message");
        this.appendStatementInput("message_received")
            .setCheck(null);
        this.setPreviousStatement(true, null);
        this.setNextStatement(true, null);
        this.setColour(330);
     this.setTooltip("");
     this.setHelpUrl("");
      }
    };
  Blockly.Blocks['websocket_server'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("Websocket Server");
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(330);
    this.setTooltip('websocket server');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['sleep'] = {
  init: function() {
    this.appendValueInput("seconds")
        .setCheck(null)
        .appendField("sleep");
    this.appendDummyInput()
        .appendField("secs");
    this.setInputsInline(true);
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(95);
 this.setTooltip("");
 this.setHelpUrl("");
  }
};
Blockly.Blocks['message_received'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("message_received")
        .appendField(new Blockly.FieldVariable("client"), "client")
        .appendField(new Blockly.FieldVariable("server"), "server")
        .appendField(new Blockly.FieldVariable("message"), "message");
    this.appendStatementInput("message_received")
        .setCheck(null);
    this.setColour(330);
    this.setTooltip('message_received');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['server_send_message_to_all'] = {
  init: function() {
    this.appendValueInput("message")
        .setCheck(null)
        .appendField("server.send_message_to_all");
    this.setInputsInline(true);
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(330);
    this.setTooltip('server.send_message_to_all');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['mechabyte_init'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("Mecha:Byte Init");
    this.appendValueInput("port")
        .setCheck(null)
        .appendField(new Blockly.FieldCheckbox("TRUE"), "streaming_switch")
        .appendField("start video streaming on port");
    this.setInputsInline(false);
    this.setNextStatement(true, null);
    this.setColour(95);
 this.setTooltip("");
 this.setHelpUrl("");
  }
};
Blockly.Blocks['macrobyte_init'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("Mecha Byte Init");
    this.setPreviousStatement(false, null);
    this.setNextStatement(true, null);
    this.setColour(512);
    this.setTooltip('Mecha BYTE Init.');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['start_streaming'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("start video streaming on");
    this.appendValueInput("port")
        .setCheck(null)
        .appendField("port");
    this.setInputsInline(true);
  }
};
Blockly.Blocks['car_init'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("MechaCar init with");
    this.appendDummyInput()
        .appendField("DC2")
        .appendField(new Blockly.FieldDropdown([["A","A"], ["B","B"]]), "port2")
        .appendField("as forward and");
    this.appendDummyInput()
        .appendField("DC4")
        .appendField(new Blockly.FieldDropdown([["A","A"], ["B","B"]]), "port4")
        .appendField("as forward");
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(512);
    this.setTooltip('MechaCar Init.');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['car_forward'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("MechaCar forward");
    this.appendValueInput("speed")
        .setCheck(null)
        .appendField("with speed");
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setInputsInline(true);
    this.setColour(512);
    this.setTooltip('');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['car_backward'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("MechaCar backward");
    this.appendValueInput("speed")
        .setCheck(null)
        .appendField("with speed");
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setInputsInline(true);
    this.setColour(512);
    this.setTooltip('');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['car_spin_left'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("MechaCar turn left");
    this.appendValueInput("speed")
        .setCheck(null)
        .appendField("with speed");
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setInputsInline(true);
    this.setColour(512);
    this.setTooltip('');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['car_spin_right'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("MechaCar turn right");
    this.appendValueInput("speed")
        .setCheck(null)
        .appendField("with speed");
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setInputsInline(true);
    this.setColour(512);
    this.setTooltip('');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['car_stop'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("MechaCar stop");
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setInputsInline(true);
    this.setColour(512);
    this.setTooltip('');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['car_pid'] = {
  init: function() {
    //this.appendDummyInput()
        //.appendField("MechaCar settle");
    this.appendValueInput("measure")
        .setCheck(null)
        .appendField("MechaCar now at")
        .setAlign(Blockly.ALIGN_RIGHT);
    this.appendValueInput("distance")
        .setCheck(null)
        .appendField("and settles at")
        .setAlign(Blockly.ALIGN_RIGHT);
    this.appendDummyInput()
        .appendField("using PID control");
    this.appendValueInput("kp")
        .setCheck(null)
        .appendField("with Kp")
        .setAlign(Blockly.ALIGN_RIGHT);
    this.appendValueInput("ki")
        .setCheck(null)
        .appendField("Ki")
        .setAlign(Blockly.ALIGN_RIGHT);;
    this.appendValueInput("kd")
        .setCheck(null)
        .appendField("Kd")
        .setAlign(Blockly.ALIGN_RIGHT);;
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setInputsInline(false);
    this.setColour(512);
    this.setTooltip('');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['set_pin_mode'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("make pin");
    this.appendValueInput("pin")
        .setCheck(null);
        this.appendDummyInput()
            .appendField("as a");
    this.appendDummyInput()
        .appendField(new Blockly.FieldDropdown([["ANALOG","ANALOG"], ["DIGITAL","DIGITAL"]]), "type")
        .appendField(new Blockly.FieldDropdown([["INPUT","INPUT"], ["OUTPUT","OUTPUT"], ["PWM","PWM"]]), "mode");
    this.setInputsInline(true);
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(75);
    this.setTooltip('');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['write_pin'] = {
  init: function() {
    this.appendDummyInput()
        .appendField(new Blockly.FieldDropdown([["digital","digital"], ["analog","analog"]]), "type");
    this.appendValueInput("pin")
        .setCheck(null)
        .appendField("write to pin");
    this.appendValueInput("value")
        .setCheck(null)
        .appendField("with value");
    this.setInputsInline(true);
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(75);
    this.setTooltip('');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['read_pin'] = {
  init: function() {
    this.appendDummyInput()
        .appendField(new Blockly.FieldDropdown([["digital","digital"], ["analog","analog"]]), "type");
    this.appendValueInput("pin")
        .setCheck(null)
        .appendField("read on pin");
    this.setInputsInline(true);
    this.setOutput(true, null);
    this.setColour(75);
    this.setTooltip('');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['play_tone'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("play tone at pin");
    this.appendValueInput("pin")
        .setCheck(null);
    this.appendDummyInput()
        .appendField(new Blockly.FieldDropdown([["TONE_TONE","TONE_TONE"], ["TONE_NO_TONE","TONE_NO_TONE"]]), "cmd");
    this.appendValueInput("frequency")
        .setCheck(null)
        .appendField("frequency");
    this.appendValueInput("duration")
        .setCheck(null)
        .appendField("duration");
    this.setInputsInline(true);
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(60);
    this.setTooltip('');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['servo_setup'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("using servo")
        .appendField(new Blockly.FieldDropdown([["1","14"], ["2","15"], ["3","16"], ["4","17"], ["5","4"], ["6","7"]]), "pin");
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(512);
 this.setTooltip("");
 this.setHelpUrl("");
  }
};
Blockly.Blocks['servo_rotate'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("move servo")
        .appendField(new Blockly.FieldDropdown([["1","14"], ["2","15"], ["3","16"], ["4","17"], ["5","4"], ["6","7"]]), "pin");
    this.appendValueInput("value")
        .setCheck(null)
        .appendField("to");
    this.appendDummyInput()
        .appendField("degrees");
    this.setInputsInline(true);
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(512);
 this.setTooltip("");
 this.setHelpUrl("");
  }
};
Blockly.Blocks['servo_config'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("servo config");
    this.appendValueInput("pin")
        .setCheck(null)
        .appendField("pin");
    this.setInputsInline(true);
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(35);
    this.setTooltip('');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['servo_set'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("servo set");
    this.appendValueInput("pin")
        .setCheck(null)
        .appendField("pin");
    this.appendValueInput("value")
        .setCheck(null)
        .appendField("value");
    this.setInputsInline(true);
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(35);
    this.setTooltip('');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['dc_setup'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("using DC")
        .appendField(new Blockly.FieldDropdown([["1","13"], ["2","11"], ["3","9"], ["4","6"]]), "channel");
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(512);
 this.setTooltip("");
 this.setHelpUrl("");
  }
};
Blockly.Blocks['dc_spin'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("make DC")
        .appendField(new Blockly.FieldDropdown([["1","13"], ["2","11"], ["3","9"], ["4","6"]]), "channel");
    this.appendDummyInput()
        .appendField("run with");
    this.appendDummyInput()
        .appendField(new Blockly.FieldDropdown([["A","A"], ["B","B"]]), "polarity");
    this.appendValueInput("value")
        .setCheck(null)
        .appendField("");
    this.setInputsInline(true);
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(512);
    this.setTooltip('');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['i2c_init'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("i2c Init. 2(SDA) 3(SCL)");
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(315);
 this.setTooltip("");
 this.setHelpUrl("");
  }
};
Blockly.Blocks['i2c_write'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("i2c write");
    this.appendValueInput("addr")
        .setCheck(null)
        .appendField("addr");
    this.appendValueInput("data")
        .setCheck(null)
        .appendField("data");
    this.setInputsInline(true);
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(315);
 this.setTooltip("");
 this.setHelpUrl("");
  }
};
Blockly.Blocks['sonar_config'] = {
  init: function() {
    this.appendValueInput("trigger")
        .setCheck(null)
        .appendField("sonar config trigger");
    this.appendValueInput("echo")
        .setCheck(null)
        .appendField("echo");
    this.setInputsInline(true);
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(270);
 this.setTooltip("");
 this.setHelpUrl("");
  }
};
Blockly.Blocks['get_sonar_data'] = {
  init: function() {
    this.appendValueInput("trigger")
        .setCheck(null)
        .appendField("get sonar data from trigger");
    this.setInputsInline(true);
    this.setOutput(true, null);
    this.setColour(270);
 this.setTooltip("");
 this.setHelpUrl("");
  }
};
/*
Blockly.Blocks['display_clear'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("display clear");
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(260);
    this.setTooltip('');
    this.setHelpUrl('');
  }
};
Blockly.Blocks['plot'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("plot(");
    this.appendValueInput("x")
        .setCheck(null)
        .appendField("x :");
    this.appendDummyInput()
        .appendField(",");
    this.appendValueInput("y")
        .setCheck(null)
        .appendField("y :");
    this.appendDummyInput()
        .appendField(",");
    this.appendValueInput("c")
        .setCheck(null)
        .appendField("1/0 :");
    this.appendDummyInput()
        .appendField(")");
    this.setInputsInline(true);
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(260);
    this.setTooltip('plot');
    this.setHelpUrl('');
  }
};
	  Blockly.Blocks['gpio'] = {
	    init: function() {
	      this.appendValueInput("port")
	          .setCheck("Number")
	          .appendField("gpio port number");
	      this.appendValueInput("value")
	          .setCheck("Number")
	          .appendField("value");
	      this.setInputsInline(true);
	      this.setPreviousStatement(true, null);
	      this.setNextStatement(true, null);
	      this.setColour(60);
	      this.setTooltip('gpio');
	      this.setHelpUrl('');
	    }
	  };
Blockly.Blocks['mt7688_pinmax'] = {
  init: function() {
    this.appendDummyInput()
        .appendField("mt7688_pinmax");
    this.appendDummyInput()
        .appendField("i2c")
        .appendField(new Blockly.FieldDropdown([["i2c","i2c"], ["gpio","gpio"]]), "i2c");
    this.appendDummyInput()
        .appendField("uart0")
        .appendField(new Blockly.FieldDropdown([["uart","uart"], ["gpio","gpio"]]), "uart0");
    this.appendDummyInput()
        .appendField("uart1")
        .appendField(new Blockly.FieldDropdown([["uart","uart"], ["gpio","gpio"]]), "uart1");
    this.appendDummyInput()
        .appendField("uart2")
        .appendField(new Blockly.FieldDropdown([["uart","uart"], ["gpio","gpio"], ["pwm","pwm"]]), "uart2");
    this.appendDummyInput()
        .appendField("pwm0")
        .appendField(new Blockly.FieldDropdown([["pwm","pwm"], ["gpio","gpio"]]), "pwm0");
    this.appendDummyInput()
        .appendField("pwm1")
        .appendField(new Blockly.FieldDropdown([["pwm","pwm"], ["gpio","gpio"]]), "pwm1");
    this.appendDummyInput()
        .appendField("refclk")
        .appendField(new Blockly.FieldDropdown([["gpio","gpio"], ["refclk","refclk"]]), "refclk");
    this.appendDummyInput()
        .appendField("spi_s")
        .appendField(new Blockly.FieldDropdown([["gpio","gpio"], ["spi_s","spi_s"]]), "spi_s");
    this.appendDummyInput()
        .appendField("spi_cs1")
        .appendField(new Blockly.FieldDropdown([["spi_cs1","spi_cs1"], ["gpio","gpio"], ["ref_clk","ref_clk"]]), "spi_cs1");
    this.appendDummyInput()
        .appendField("i2s")
        .appendField(new Blockly.FieldDropdown([["gpio","gpio"], ["i2s","i2s"], ["pcm","pcm"]]), "i2s");
    this.appendDummyInput()
        .appendField("ephy(43)")
        .appendField(new Blockly.FieldDropdown([["ephy","ephy"], ["gpio","gpio"]]), "ephy");
    this.appendDummyInput()
        .appendField("wled(44)")
        .appendField(new Blockly.FieldDropdown([["wled","wled"], ["gpio","gpio"]]), "wled");
    this.setPreviousStatement(true, null);
    this.setNextStatement(true, null);
    this.setColour(60);
    this.setTooltip('mt7688_pinmax');
    this.setHelpUrl('');
  }
};
*/
  </script>
</head>
<body>


<table >
	<tr >
  	  <table width="100%" height="70%">
    	<tr >
			<td >
        <div class="watermark">
                   Beta
            </div>
		<!--
      	<td style="background-image:url(logo.png);background-repeat:no-repeat;background-size:250px 42px;" width="250" height="42">
			<h1></h1>
		-->
				  <h1 style="text-shadow: 2px 2px #ffffff;">Mecha:BYTE
          		  Project Name:<input type="text" id="projectname">
			  </h1>
      		</td>
      <td class="farSide">
        <select id="languageMenu"></select>
      </td>
    </tr>
        <tr>
          <td colspan=2>
            <table width="100%">
              <tr id="tabRow" height="1em">
            <td id="tab_blocks" class="tabon">...</td>
            <td class="tabmin">&nbsp;</td>
            <td id="tab_python" class="taboff">Python</td>
            <td class="tabmin">&nbsp;</td>
			<!--
            <td id="tab_javascript" class="taboff">JavaScript</td>
            <td class="tabmin">&nbsp;</td>
            <td id="tab_php" class="taboff">PHP</td>
            <td class="tabmin">&nbsp;</td>
            <td id="tab_lua" class="taboff">Lua</td>
            <td class="tabmin">&nbsp;</td>
            <td id="tab_dart" class="taboff">Dart</td>
            <td class="tabmin">&nbsp;</td>
			-->
            <td id="tab_xml" class="taboff">XML</td>
            <td class="tabmax">
              <button id="downloadScriptButton" class="notext" title="...">
                <img src='../../media/1x1.gif' class="download icon21">
              </button>
              <button id="uploadScriptButton" class="notext secondary" title="...">
                <img src='../../media/1x1.gif' class="upload icon21">
              </button>
              <button id="trashButton" class="notext" title="...">
                <img src='../../media/1x1.gif' class="trash icon21">
              </button>
              <button id="linkButton" class="notext" title="...">
                <img src='../../media/1x1.gif' class="link icon21">
              </button>
              <!--
              <button id="runButton" class="notext primary" title="...">
                <img src='../../media/1x1.gif' class="run icon21">
              </button>
                -->
            </td>
          </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td height="99%" colspan=2 id="content_area">
          </td>
        </tr>
      </table>
  </tr>
  <tr>
	    <table width="100%">
		<tr>
		<td>
			<!--
		  <br>
		  <button onclick="init(); return false;">init</button>
		  <button onclick="onCloseClick(); return false;">close</button>
			-->
	  </td>
	  </tr>
	  <tr>
		<td>
			  <textarea id="log"></textarea>
	  </td>
	  </tr>
	  <tr>
		<td >
      <button onclick="onSubmit(); return false;">Send</button>
<!--		  <form onsubmit="onSubmit(); return false;"> -->
			  <input type="text" id="input">
<!--			  <input type="submit" value="Send">  -->
<!--		  </form>  -->
	  </td>
	  </tr>
	</table>
  </tr>
</table>
  <!--<div id="blocklyDiv" style="height: 400px"></div>-->
  <div id="content_blocks" class="content"></div>
  <pre id="content_javascript" class="content"></pre>
  <pre id="content_python" class="content"></pre>
  <pre id="content_php" class="content"></pre>
  <pre id="content_lua" class="content"></pre>
  <pre id="content_dart" class="content"></pre>
  <textarea id="content_xml" class="content" wrap="off"></textarea>

  <xml id="toolbox" style="display: none">
  <category name="System" colour="#7BA65C">
    <block type="mechabyte_init">
      <value name="port">
        <shadow type="math_number">
          <field name="NUM">8080</field>
        </shadow>
      </value>
    </block>
    <!--
    <block type="websocket_"></block>
    <block type="server_send_message_to_all"></block>
    -->
      <!--
    <block type="start_streaming" colour='#000000'>
      <value name="port">
        <shadow type="math_number">
          <field name="NUM">8080</field>
        </shadow>
      </value>
    </block>
        -->
    <block type="sleep">
      <value name="seconds">
        <shadow  type="math_number">
          <field name="NUM">1</field>
        </shadow>
      </value>
    </block>
  </category>
  <category name="MechaCar" colour="#000000">
    <block type="car_init" colour="#000000"></block>
    <block type="servo_setup"></block>
    <block type="servo_rotate">
      <value name="value">
        <shadow  type="math_number">
          <field name="NUM">180</field>
        </shadow>
      </value>
    </block>
    <block type="dc_setup">
      <value name="channel">
        <shadow type="math_number">
          <field name="NUM">1</field>
        </shadow>
      </value>
    </block>
    <block type="dc_spin" colour="#000000">
      <value name="channel">
        <shadow type="math_number">
          <field name="NUM">1</field>
        </shadow>
      </value>
      <value name="port">
        <shadow type="text">
          <field name="TEXT">A</field>
        </shadow>
      </value>
      <value name="value">
        <shadow type="math_number">
          <field name="NUM">255</field>
        </shadow>
      </value>
    </block>
    <block type="car_forward" colour='#000000'>
      <value name="speed">
        <shadow type="math_number">
          <field name="NUM">255</field>
        </shadow>
      </value>
    </block>
    <block type="car_backward" colour='#000000'>
      <value name="speed">
        <shadow type="math_number">
          <field name="NUM">255</field>
        </shadow>
      </value>
    </block>
    <block type="car_spin_left" colour='#000000'>
      <value name="speed">
        <shadow type="math_number">
          <field name="NUM">255</field>
        </shadow>
      </value>
    </block>
    <block type="car_spin_right" colour='#000000'>
      <value name="speed">
        <shadow type="math_number">
          <field name="NUM">255</field>
        </shadow>
      </value>
    </block>
    <block type="car_stop" colour="#000000"></block>
    <block type="car_pid" colour='#000000'>
      <value name="kp">
        <shadow type="math_number">
          <field name="NUM">1</field>
        </shadow>
      </value>
      <value name="ki">
        <shadow type="math_number">
          <field name="NUM">0</field>
        </shadow>
      </value>
      <value name="kd">
        <shadow type="math_number">
          <field name="NUM">0</field>
        </shadow>
      </value>
    </block>
  </category>
  <category name="GPIO" colour="#94a65c">
    <block type="set_pin_mode">
      <value name="pin">
        <shadow  type="math_number">
          <field name="NUM">13</field>
        </shadow>
      </value>
      <field name="mode">OUTPUT</field>
      <field name="type">DIGITAL</field>
    </block>
    <block type="write_pin">
      <value name="pin">
        <shadow  type="math_number">
          <field name="NUM">13</field>
        </shadow>
      </value>
      <value name="value">
        <shadow  type="math_number">
          <field name="NUM">0</field>
        </shadow>
      </value>
      <field name="type">digital</field>
    </block>
    <block type="read_pin">
      <value name="pin">
        <shadow  type="math_number">
          <field name="NUM">13</field>
        </shadow>
      </value>
      <field name="type">digital</field>
    </block>
  </category>
  <category name="Servo" colour="#a6875c">
    <block type="servo_config">
      <value name="pin">
        <shadow  type="math_number">
          <field name="NUM">5</field>
        </shadow>
      </value>
    </block>
    <block type="servo_set">
      <value name="pin">
        <shadow  type="math_number">
          <field name="NUM">5</field>
        </shadow>
      </value>
      <value name="value">
        <shadow  type="math_number">
          <field name="NUM">180</field>
        </shadow>
      </value>
    </block>
  </category>
  <category name="Tone" colour="#a5a55b">
    <block type="play_tone">
      <field name="cmd">TONE_TONE</field>
      <value name="pin">
        <shadow  type="math_number">
          <field name="NUM">9</field>
        </shadow>
      </value>
      <value name="frequency">
        <shadow  type="math_number">
          <field name="NUM">455</field>
        </shadow>
      </value>
      <value name="duration">
        <shadow  type="math_number">
          <field name="NUM">800</field>
        </shadow>
      </value>
    </block>
  </category>
  <category name="i2c" colour="#a65c94">
    <block type="i2c_init">
    </block>
    <block type="i2c_write">
      <value name="addr">
        <shadow  type="text">
          <field name="TEXT">0</field>
        </shadow>
      </value>
      <value name="data">
        <shadow  type="text">
          <field name="TEXT">0</field>
        </shadow>
      </value>
    </block>
  </category>
  <category name="Sonar" colour="#815ca6">
    <block type="sonar_config">
      <value name="trigger">
        <shadow  type="math_number">
          <field name="NUM">8</field>
        </shadow>
      </value>
      <value name="echo">
        <shadow  type="math_number">
          <field name="NUM">7</field>
        </shadow>
      </value>
    </block>
    <block type="get_sonar_data">
      <value name="trigger">
        <shadow  type="math_number">
          <field name="NUM">8</field>
        </shadow>
      </value>
    </block>
  </category>
  <sep></sep>
<!--
  <category name="MacroByte" colour="#a5a55b">
    <block type="websocket_server"></block>
	  <block type="message_received">
      <field name="client">client</field>
      <field name="server">server</field>
      <field name="message">message</field>
    </block>
    <block type="display_clear"></block>
    <block type="plot"></block>
  </category>
  -->
    <category name="%{BKY_CATLOGIC}" colour="%{BKY_LOGIC_HUE}">
      <block type="controls_if"></block>
      <block type="logic_compare"></block>
      <block type="logic_operation"></block>
      <block type="logic_negate"></block>
      <block type="logic_boolean"></block>
      <block type="logic_null"></block>
      <block type="logic_ternary"></block>
    </category>
    <category name="%{BKY_CATLOOPS}" colour="%{BKY_LOOPS_HUE}">
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="controls_whileUntil">
        <value name="BOOL">
          <shadow type="logic_boolean">
            <field name="BOOL">true</field>
          </shadow>
        </value>
      </block>
      <block type="controls_for">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
        <value name="BY">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="controls_forEach"></block>
      <block type="controls_flow_statements"></block>
    </category>
    <category name="%{BKY_CATMATH}" colour="%{BKY_MATH_HUE}">
      <block type="math_number"></block>
    <block type="graph_set_y" deletable="true" x="100" y="100">
      <value name="VALUE">
      </value>
    </block>
      <block type="math_arithmetic">
        <value name="A">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="B">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="math_single">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">9</field>
          </shadow>
        </value>
      </block>
      <block type="math_trig">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">45</field>
          </shadow>
        </value>
      </block>
      <block type="math_constant"></block>
      <block type="math_number_property">
        <value name="NUMBER_TO_CHECK">
          <shadow type="math_number">
            <field name="NUM">0</field>
          </shadow>
        </value>
      </block>
      <block type="math_round">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">3.1</field>
          </shadow>
        </value>
      </block>
      <block type="math_on_list"></block>
      <block type="math_modulo">
        <value name="DIVIDEND">
          <shadow type="math_number">
            <field name="NUM">64</field>
          </shadow>
        </value>
        <value name="DIVISOR">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="math_constrain">
        <value name="VALUE">
          <shadow type="math_number">
            <field name="NUM">50</field>
          </shadow>
        </value>
        <value name="LOW">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="HIGH">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
      </block>
      <block type="math_random_int">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
      </block>
      <block type="math_random_float"></block>
    </category>
    <category name="%{BKY_CATTEXT}" colour="%{BKY_TEXTS_HUE}">
      <block type="text"></block>
      <block type="text_join"></block>
      <block type="text_append">
        <value name="TEXT">
          <shadow type="text"></shadow>
        </value>
      </block>
      <block type="text_length">
        <value name="VALUE">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_isEmpty">
        <value name="VALUE">
          <shadow type="text">
            <field name="TEXT"></field>
          </shadow>
        </value>
      </block>
      <block type="text_indexOf">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{textVariable}</field>
          </block>
        </value>
        <value name="FIND">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_charAt">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{textVariable}</field>
          </block>
        </value>
      </block>
      <block type="text_getSubstring">
        <value name="STRING">
          <block type="variables_get">
            <field name="VAR">{textVariable}</field>
          </block>
        </value>
      </block>
      <block type="text_changeCase">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_trim">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_print">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_prompt_ext">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
    </category>
    <category name="%{BKY_CATLISTS}" colour="%{BKY_LISTS_HUE}">
      <block type="lists_create_with">
        <mutation items="0"></mutation>
      </block>
      <block type="lists_create_with"></block>
      <block type="lists_repeat">
        <value name="NUM">
          <shadow type="math_number">
            <field name="NUM">5</field>
          </shadow>
        </value>
      </block>
      <block type="lists_length"></block>
      <block type="lists_isEmpty"></block>
      <block type="lists_indexOf">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_getIndex">
        <value name="VALUE">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_setIndex">
        <value name="LIST">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_getSublist">
        <value name="LIST">
          <block type="variables_get">
            <field name="VAR">{listVariable}</field>
          </block>
        </value>
      </block>
      <block type="lists_split">
        <value name="DELIM">
          <shadow type="text">
            <field name="TEXT">,</field>
          </shadow>
        </value>
      </block>
      <block type="lists_sort"></block>
    </category>
    <category name="%{BKY_CATCOLOUR}" colour="%{BKY_COLOUR_HUE}">
      <block type="colour_picker"></block>
      <block type="colour_random"></block>
      <block type="colour_rgb">
        <value name="RED">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
        <value name="GREEN">
          <shadow type="math_number">
            <field name="NUM">50</field>
          </shadow>
        </value>
        <value name="BLUE">
          <shadow type="math_number">
            <field name="NUM">0</field>
          </shadow>
        </value>
      </block>
      <block type="colour_blend">
        <value name="COLOUR1">
          <shadow type="colour_picker">
            <field name="COLOUR">#ff0000</field>
          </shadow>
        </value>
        <value name="COLOUR2">
          <shadow type="colour_picker">
            <field name="COLOUR">#3333ff</field>
          </shadow>
        </value>
        <value name="RATIO">
          <shadow type="math_number">
            <field name="NUM">0.5</field>
          </shadow>
        </value>
      </block>
    </category>
    <sep></sep>
    <category name="%{BKY_CATVARIABLES}" colour="%{BKY_VARIABLES_HUE}" custom="VARIABLE"></category>
    <category name="%{BKY_CATFUNCTIONS}" colour="%{BKY_PROCEDURES_HUE}" custom="PROCEDURE"></category>
  </xml>

<script>
  $(document).keyup(function (e) {
      if ($(".input:focus") && (e.keyCode === 13)) {
        onSubmit();
      }
   });

    var ws;
    var wsStatus;
    var wsErrorStatus;

    if(ws == undefined) setInterval(init, 1000);

    function init() {
		if (ws != undefined) return;
      // Connect to Web Socket
      ws = new WebSocket("ws://"+window.location.hostname+":8008");

      // Set event handlers.
      ws.onopen = function() {
        output("onopen\n");
        wsStatus = "open";
      };

      ws.onmessage = function(e) {
        // e.data contains received string.
        output("onmessage: " + e.data);
      };

      ws.onclose = function() {
        if(wsStatus != "close") output("onclose\n");
        ws = undefined;
        wsStatus = "close";
      };

      ws.onerror = function(e) {
        if(wsErrorStatus != e.code) {
          //output("onerror\n");
          output("error: " + e.code +"\n");
          console.log(e)
        }
        ws = undefined;
        wsErrorStatus = e.code;
      };

    }

    function onSubmit() {
      var input = document.getElementById("input");
      // You can send message to the Web Socket using ws.send.
      newline = input.value + "\n";
      ws.send(newline);
      output("send: " + newline);
      input.value = "";
      input.focus();
    }

    function onCloseClick() {
      ws.close();
	    ws = undefined;
    }

    function output(str) {
      var log = document.getElementById("log");
      var escaped = str.replace(/&/, "&amp;").replace(/</, "&lt;").
        replace(/>/, "&gt;").replace(/"/, "&quot;"); // "
       log.innerHTML = log.innerHTML + "" + escaped;
       log.scrollTop = log.scrollHeight
    }
</script>
</body>
</html>
